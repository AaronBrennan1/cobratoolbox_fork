name: MATLAB MLX to HTML Conversion

# Trigger the workflow on push events but only for the main branch
on:
  push:
    branches:
      - gh-pages
    paths:
    - '**.mlx'

# The jobs key is a collection of the jobs to run
jobs:
  convert-mlx-to-html:
    # The type of runner that the job will run on
    runs-on: self-hosted

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2   

    - name: Get Changed MLX Files
      id: getfile
      run: |
          changed_files=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep '\.mlx' || echo "")
          echo "Changed MLX files: $changed_files"
          echo "::set-output name=mlx_file::$changed_files"

      

    - name: Make MATLAB Script Executable
      run: chmod +x ./run_matlab.sh

    - name: Convert MLX to HTML
      if: steps.getfile.outputs.mlx_file != ''
      run: |
          ./run_matlab.sh "${{ steps.getfile.outputs.mlx_file }}"
          
        
    - name: Commit and Push New File      
      run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          git add .
          git commit -m "Add new HTML file" || echo "No changes to commit"
          git push -f origin gh-pages

    - name: Add binary submodule
      run: |
        git submodule add https://github.com/opencobra/COBRA.binary.git

