<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="MATLAB R2016a"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><title>Simulation of growth of human gut microbes on different diets</title><style type="text/css">
* {margin: 0; padding: 0;}
body {text-align: start; line-height: 17.2339992523193px; min-height: 0px; white-space: normal; color: rgb(0, 0, 0); font-family: Consolas, Inconsolata, Menlo, monospace; font-style: normal; font-size: 14px; font-weight: normal; text-decoration: none; white-space: normal; }
h1, h2 {font-weight: normal;}
.content { padding: 30px; }

.S0 { margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S1 { line-height: 26.3999996185303px; min-height: 24px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-size: 22px; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 15px; margin-right: 10px;  }
.S2 { min-height: 0px; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S3 { line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 15px; margin-bottom: 9px; margin-right: 10px;  }
.S4 { line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 2px; margin-bottom: 9px; margin-right: 10px;  }
.S5 { margin-left: 3px; margin-top: 10px; margin-bottom: 4px; margin-right: 3px;  }
.S6 { line-height: 15.5926666259766px; min-height: 18px; white-space: nowrap; font-size: 12.6666669845581px; white-space: nowrap; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S7 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S8 { line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 9px; margin-right: 10px;  }
.S9 { margin-left: 3px; margin-top: 10px; margin-bottom: 10px; margin-right: 3px;  }
.S10 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S11 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(160, 32, 240); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S12 { line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 10px; margin-bottom: 9px; margin-right: 10px;  }
.S13 { margin-left: 3px; margin-top: 4px; margin-bottom: 10px; margin-right: 3px;  }
.S14 { margin-left: 3px; margin-top: 4px; margin-bottom: 4px; margin-right: 3px;  }
.S15 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(34, 139, 34); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S16 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(0, 0, 255); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S17 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(0, 0, 255); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S18 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(160, 32, 240); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }

.LineNodeBlock {margin: 10px 0 10px 0; background-color: #F7F7F7;}
.LineNodeBlock+.paragraphNode {margin-top: 10px;}
.lineNode {padding-left: 10px; border-left: 1px solid #E9E9E9; border-right: 1px solid #E9E9E9;}
.inlineWrapper:first-child .lineNode,.inlineWrapper.outputs+.inlineWrapper .lineNode {padding-top: 5px; border-top: 1px solid #E9E9E9;}
.inlineWrapper:last-child .lineNode,.inlineWrapper.outputs .lineNode {padding-bottom: 5px; border-bottom: 1px solid #E9E9E9;}
.lineNode .textBox {white-space: pre;}
</style></head><body><div class = "content"><div class = 'SectionBlock containment active'><h1 class = "S1"><span class = "S2">Simulation of growth of human gut microbes on different diets</span></h1><h2 class = "S3"><span class = "S2">Author: Almut Heinken, Molecular Systems Physiology Group, University of Luxembourg.</span></h2><div class = "S4"><span class = "S2">This tutorial shows how to simulate growth of the AGORA gut microbial models (or other microbial models) on different dietary inputs under aerobic and anaerobic conditions.</span></div><h2 class = "S3"><span class = "S2">Initialize the COBRA Toolbox</span></h2><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">initCobraToolbox</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2">Prepare input data and models</span></h2><div class = "S4"><span class = "S2">change directory to where the tutorial is located</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">tutorialPath = fileparts(which(</span><span class = "S11">'tutorial_simulateAGORAGrowthInDiets'</span><span class = "S7">));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">cd(tutorialPath);</span></div></div></div><div class = "S12"><span class = "S2">We will use the AGORA resource (Magnusdottir et al., Nat Biotechnol. 2017 Jan;35(1):81-89) in this tutorial. AGORA version 1.03 is available at https://github.com/VirtualMetabolicHuman/AGORA. Download AGORA and place the models into a folder.</span></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">system(</span><span class = "S11">'curl -LJO https://github.com/VirtualMetabolicHuman/AGORA/archive/master.zip'</span><span class = "S7">)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">unzip(</span><span class = "S11">'AGORA-master'</span><span class = "S7">)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">modPath = [pwd filesep </span><span class = "S11">'AGORA-master' </span><span class = "S10">filesep </span><span class = "S11">'CurrentVersion' </span><span class = "S10">filesep </span><span class = "S11">'AGORA_1_03' </span><span class = "S10">filesep' </span><span class = "S11">'AGORA_1_03_mat'</span><span class = "S7">];</span></div></div></div><div class = "S12"><span class = "S2">Import a file with information on the AGORA organisms including reconstruction names and taxonomy.</span></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">[~,infoFile,~]=xlsread(</span><span class = "S11">'AGORA_infoFile.xlsx'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S15">% Load the AGORA reconstructions.</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2">Load the AGORA reconstructions to be joined.</span></h2><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S16">for </span><span class = "S7">i=2:size(infoFile,1)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    model=readCbModel([modPath filesep infoFile{i,1} </span><span class = "S11">'.mat'</span><span class = "S7">]);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S10">inputModels</span><span class = "S7">{i-1,1}=model;</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S17">end</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2">Simulation of growth on a Western and a high fiber diet in presence and absence of oxygen</span></h2><div class = "S4"><span class = "S2">The diets were first described in Table S12, Magnusdottir et al., Nat Biotechnol. 2017 Jan;35(1):81-89. Please note that there are slight differences between this implementation of the Western diet and the one used for simulations in the original AGORA publication (see https://www.vmh.life/files/reconstructions/AGORA/1.01/AGORA-Flux-Table.md). Since the resulting differences in growth rate are only minor, it is recommended to use the implementation provided in cobratoolbox/papers/2018_microbiomeModelingToolbox/resources. This implementation is consistent with the Western diet used in the microbeMicrobeInteractions tutorial. Both diets are simulated in presence and absence of oxygen.</span></div><h2 class = "S3"><span class = "S2">Set a Western diet as dietary input.</span></h2><div class = "S4"><span class = "S2">This will simulate growth on a diet high in simple sugars and fat, but low in fiber. </span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">dietConstraints=readtable(</span><span class = "S11">'WesternDietAGORA.txt'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">dietConstraints=table2cell(dietConstraints);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">dietConstraints(:,2)=cellstr(num2str(cell2mat(dietConstraints(:,2))));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S16">for </span><span class = "S7">i=1:size(inputModels,1)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">    model=inputModels{i,1};</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    model=changeObjective(model,model.rxns(</span><span class = "S10">find</span><span class = "S10">(strncmp(model.rxns,</span><span class = "S11">'biomass'</span><span class = "S7">,7))));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">    model=useDiet(model,dietConstraints);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    FBA=optimizeCbModel(model,</span><span class = "S11">'max'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S10">data</span><span class = "S7">(i,1)=FBA.f;</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S15">% Enable uptake of oxygen</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    model=changeRxnBounds(model,</span><span class = "S11">'EX_o2(e)'</span><span class = "S10">,-10,</span><span class = "S11">'l'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    FBA=optimizeCbModel(model,</span><span class = "S11">'max'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S10">data</span><span class = "S7">(i,2)=FBA.f;</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S17">end</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2">Set a high fiber diet as dietary input.</span></h2><div class = "S4"><span class = "S2">This will simulate growth on a diet high in fiber, but low in simple sugars and fat.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">dietConstraints=readtable(</span><span class = "S11">'HighFiberDietAGORA.txt'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">dietConstraints=table2cell(dietConstraints);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">dietConstraints(:,2)=cellstr(num2str(cell2mat(dietConstraints(:,2))));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S16">for </span><span class = "S7">i=1:size(inputModels,1)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">    model=inputModels{i,1};</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    model=changeObjective(model,model.rxns(</span><span class = "S10">find</span><span class = "S10">(strncmp(model.rxns,</span><span class = "S11">'biomass'</span><span class = "S7">,7))));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">    model=useDiet(model,dietConstraints);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    FBA=optimizeCbModel(model,</span><span class = "S11">'max'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">    data(i,3)=FBA.f;</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S15">% Enable uptake of oxygen</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    model=changeRxnBounds(model,</span><span class = "S11">'EX_o2(e)'</span><span class = "S10">,-10,</span><span class = "S11">'l'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    FBA=optimizeCbModel(model,</span><span class = "S11">'max'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">    data(i,4)=FBA.f;</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S17">end</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2">Plot the growth rates on the two diets.</span></h2><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">dataAll=vertcat(data(:,1),data(:,2),data(:,3),data(:,4));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">group=cell(size(data,1),4);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">group(:,1)={</span><span class = "S11">'Western diet, anoxic'</span><span class = "S7">};</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">group(:,2)={</span><span class = "S11">'Western diet, oxic'</span><span class = "S7">};</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">group(:,3)={</span><span class = "S11">'High fiber diet, anoxic'</span><span class = "S7">};</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">group(:,4)={</span><span class = "S11">'High fiber diet, oxic'</span><span class = "S7">};</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">groupAll=vertcat(group(:,1),group(:,2),group(:,3),group(:,4));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">figure</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">boxplot(dataAll,groupAll,</span><span class = "S11">'PlotStyle'</span><span class = "S10">,</span><span class = "S11">'traditional'</span><span class = "S10">,</span><span class = "S11">'BoxStyle'</span><span class = "S10">,</span><span class = "S11">'outline'</span><span class = "S7">)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">h = findobj(gca,</span><span class = "S11">'Tag'</span><span class = "S10">,</span><span class = "S11">'Box'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S15">% Change colors</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S16">for </span><span class = "S7">j=1:length(h)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S16">if </span><span class = "S7">j==1</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">        patch(get(h(j),</span><span class = "S11">'XData'</span><span class = "S10">),get(h(j),</span><span class = "S11">'YData'</span><span class = "S10">),</span><span class = "S11">'g'</span><span class = "S10">,</span><span class = "S11">'FaceAlpha'</span><span class = "S7">,.5);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S17">end</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S16">if </span><span class = "S7">j==2</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">        patch(get(h(j),</span><span class = "S11">'XData'</span><span class = "S10">),get(h(j),</span><span class = "S11">'YData'</span><span class = "S10">),</span><span class = "S11">'b'</span><span class = "S10">,</span><span class = "S11">'FaceAlpha'</span><span class = "S7">,.5);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S17">end</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S16">if </span><span class = "S7">j==3</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">        patch(get(h(j),</span><span class = "S11">'XData'</span><span class = "S10">),get(h(j),</span><span class = "S11">'YData'</span><span class = "S10">),</span><span class = "S11">'y'</span><span class = "S10">,</span><span class = "S11">'FaceAlpha'</span><span class = "S7">,.5);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S17">end</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S16">if </span><span class = "S7">j==4</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">        patch(get(h(j),</span><span class = "S11">'XData'</span><span class = "S10">),get(h(j),</span><span class = "S11">'YData'</span><span class = "S10">),</span><span class = "S11">'r'</span><span class = "S10">,</span><span class = "S11">'FaceAlpha'</span><span class = "S7">,.5);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S17">end</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S17">end</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">set(gca, </span><span class = "S11">'FontSize'</span><span class = "S7">, 12)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">title(</span><span class = "S11">'Growth rates in 818 AGORA gut microbe models on two diets'</span><span class = "S7">)</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2">Grow AGORA on a diet created with VMH Diet Designer</span></h2><div class = "S4"><span class = "S2">Here, a diet provided by the Diet Designer tool at the Virtual Metabolic Human website (https://www.vmh.life/, Noronha et al., "The Virtual Metabolic Human database: integrating human and gut microbiome metabolism with nutrition and disease", Nucleic Acids Research (2018) will be used. A number of pre-made diets are available at https://www.vmh.life/#nutrition and in cobratoolbox/papers/2018_microbiomeModelingToolbox/resources. The user can also generate a customized diet with the DietDesigner tool and use it for simulations with AGORA. Note that the diets were designed for microbiome simulations and the predicted growth rates may be very high for single AGORA models.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">dietConstraints=adaptVMHDietToAGORA(</span><span class = "S11">'AverageEuropeanDiet'</span><span class = "S10">,</span><span class = "S11">'AGORA'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">clear </span><span class = "S18">data</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S16">for </span><span class = "S7">i=1:size(inputModels,1)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">    model=inputModels{i,1};</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    model=changeObjective(model,model.rxns(</span><span class = "S10">find</span><span class = "S10">(strncmp(model.rxns,</span><span class = "S11">'biomass'</span><span class = "S7">,7))));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">    model=useDiet(model,dietConstraints);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    FBA=optimizeCbModel(model,</span><span class = "S11">'max'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S10">data</span><span class = "S7">(i,1)=FBA.f;</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S15">% Enable uptake of oxygen</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    model=changeRxnBounds(model,</span><span class = "S11">'EX_o2(e)'</span><span class = "S10">,-10,</span><span class = "S11">'l'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    FBA=optimizeCbModel(model,</span><span class = "S11">'max'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S10">data</span><span class = "S7">(i,2)=FBA.f;</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S17">end</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2">Plot the growth rates on the Average European diet.</span></h2><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">dataAll=vertcat(data(:,1),data(:,2));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">group=cell(size(data,1),2);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">group(:,1)={</span><span class = "S11">'Average European diet, anoxic'</span><span class = "S7">};</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">group(:,2)={</span><span class = "S11">'Average European diet, oxic'</span><span class = "S7">};</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">groupAll=vertcat(group(:,1),group(:,2));</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S7">figure</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">boxplot(dataAll,groupAll,</span><span class = "S11">'PlotStyle'</span><span class = "S10">,</span><span class = "S11">'traditional'</span><span class = "S10">,</span><span class = "S11">'BoxStyle'</span><span class = "S10">,</span><span class = "S11">'outline'</span><span class = "S7">)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">h = findobj(gca,</span><span class = "S11">'Tag'</span><span class = "S10">,</span><span class = "S11">'Box'</span><span class = "S7">);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S15">% Change colors</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S16">for </span><span class = "S7">j=1:length(h)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S16">if </span><span class = "S7">j==1</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">        patch(get(h(j),</span><span class = "S11">'XData'</span><span class = "S10">),get(h(j),</span><span class = "S11">'YData'</span><span class = "S10">),</span><span class = "S11">'g'</span><span class = "S10">,</span><span class = "S11">'FaceAlpha'</span><span class = "S7">,.5);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S17">end</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S16">if </span><span class = "S7">j==2</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">        patch(get(h(j),</span><span class = "S11">'XData'</span><span class = "S10">),get(h(j),</span><span class = "S11">'YData'</span><span class = "S10">),</span><span class = "S11">'b'</span><span class = "S10">,</span><span class = "S11">'FaceAlpha'</span><span class = "S7">,.5);</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">    </span><span class = "S17">end</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S17">end</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">set(gca, </span><span class = "S11">'FontSize'</span><span class = "S7">, 12)</span></div></div><div class = 'inlineWrapper'><div class = "S6 lineNode"><span class = "S10">title(</span><span class = "S11">'Growth rates in 818 AGORA gut microbe models on an Average European diet'</span><span class = "S7">)</span></div></div></div></div></div>
<!-- 
##### SOURCE BEGIN #####
%% Simulation of growth of human gut microbes on different diets
%% Author: Almut Heinken, Molecular Systems Physiology Group, University of Luxembourg.
% This tutorial shows how to simulate growth of the AGORA gut microbial models 
% (or other microbial models) on different dietary inputs under aerobic and anaerobic 
% conditions.
%% Initialize the COBRA Toolbox

initCobraToolbox
%% Prepare input data and models
% change directory to where the tutorial is located
%%
tutorialPath = fileparts(which('tutorial_simulateAGORAGrowthInDiets'));
cd(tutorialPath);
%% 
% We will use the AGORA resource (Magnusdottir et al., Nat Biotechnol. 2017 
% Jan;35(1):81-89) in this tutorial. AGORA version 1.03 is available at https://github.com/VirtualMetabolicHuman/AGORA. 
% Download AGORA and place the models into a folder.
%%
system('curl -LJO https://github.com/VirtualMetabolicHuman/AGORA/archive/master.zip')
unzip('AGORA-master')
modPath = [pwd filesep 'AGORA-master' filesep 'CurrentVersion' filesep 'AGORA_1_03' filesep' 'AGORA_1_03_mat'];
%% 
% Import a file with information on the AGORA organisms including reconstruction 
% names and taxonomy.
%%
[~,infoFile,~]=xlsread('AGORA_infoFile.xlsx');
% Load the AGORA reconstructions.
%% Load the AGORA reconstructions to be joined.
%%
for i=2:size(infoFile,1)
    model=readCbModel([modPath filesep infoFile{i,1} '.mat']);
    inputModels{i-1,1}=model;
end
%% Simulation of growth on a Western and a high fiber diet in presence and absence of oxygen
% The diets were first described in Table S12, Magnusdottir et al., Nat Biotechnol. 
% 2017 Jan;35(1):81-89. Please note that there are slight differences between 
% this implementation of the Western diet and the one used for simulations in 
% the original AGORA publication (see https://www.vmh.life/files/reconstructions/AGORA/1.01/AGORA-Flux-Table.md). 
% Since the resulting differences in growth rate are only minor, it is recommended 
% to use the implementation provided in cobratoolbox/papers/2018_microbiomeModelingToolbox/resources. 
% This implementation is consistent with the Western diet used in the microbeMicrobeInteractions 
% tutorial. Both diets are simulated in presence and absence of oxygen.
%% Set a Western diet as dietary input.
% This will simulate growth on a diet high in simple sugars and fat, but low 
% in fiber. 
%%
dietConstraints=readtable('WesternDietAGORA.txt');
dietConstraints=table2cell(dietConstraints);
dietConstraints(:,2)=cellstr(num2str(cell2mat(dietConstraints(:,2))));
for i=1:size(inputModels,1)
    model=inputModels{i,1};
    model=changeObjective(model,model.rxns(find(strncmp(model.rxns,'biomass',7))));
    model=useDiet(model,dietConstraints);
    FBA=optimizeCbModel(model,'max');
    data(i,1)=FBA.f;
    % Enable uptake of oxygen
    model=changeRxnBounds(model,'EX_o2(e)',-10,'l');
    FBA=optimizeCbModel(model,'max');
    data(i,2)=FBA.f;
end
%% Set a high fiber diet as dietary input.
% This will simulate growth on a diet high in fiber, but low in simple sugars 
% and fat.
%%
dietConstraints=readtable('HighFiberDietAGORA.txt');
dietConstraints=table2cell(dietConstraints);
dietConstraints(:,2)=cellstr(num2str(cell2mat(dietConstraints(:,2))));
for i=1:size(inputModels,1)
    model=inputModels{i,1};
    model=changeObjective(model,model.rxns(find(strncmp(model.rxns,'biomass',7))));
    model=useDiet(model,dietConstraints);
    FBA=optimizeCbModel(model,'max');
    data(i,3)=FBA.f;
    % Enable uptake of oxygen
    model=changeRxnBounds(model,'EX_o2(e)',-10,'l');
    FBA=optimizeCbModel(model,'max');
    data(i,4)=FBA.f;
end
%% Plot the growth rates on the two diets.
%%
dataAll=vertcat(data(:,1),data(:,2),data(:,3),data(:,4));
group=cell(size(data,1),4);
group(:,1)={'Western diet, anoxic'};
group(:,2)={'Western diet, oxic'};
group(:,3)={'High fiber diet, anoxic'};
group(:,4)={'High fiber diet, oxic'};
groupAll=vertcat(group(:,1),group(:,2),group(:,3),group(:,4));
figure
boxplot(dataAll,groupAll,'PlotStyle','traditional','BoxStyle','outline')
h = findobj(gca,'Tag','Box');
% Change colors
for j=1:length(h)
    if j==1
        patch(get(h(j),'XData'),get(h(j),'YData'),'g','FaceAlpha',.5);
    end
    if j==2
        patch(get(h(j),'XData'),get(h(j),'YData'),'b','FaceAlpha',.5);
    end
    if j==3
        patch(get(h(j),'XData'),get(h(j),'YData'),'y','FaceAlpha',.5);
    end
    if j==4
        patch(get(h(j),'XData'),get(h(j),'YData'),'r','FaceAlpha',.5);
    end
end
set(gca, 'FontSize', 12)
title('Growth rates in 818 AGORA gut microbe models on two diets')
%% Grow AGORA on a diet created with VMH Diet Designer
% Here, a diet provided by the Diet Designer tool at the Virtual Metabolic Human 
% website (https://www.vmh.life/, Noronha et al., "The Virtual Metabolic Human 
% database: integrating human and gut microbiome metabolism with nutrition and 
% disease", Nucleic Acids Research (2018) will be used. A number of pre-made diets 
% are available at https://www.vmh.life/#nutrition and in cobratoolbox/papers/2018_microbiomeModelingToolbox/resources. 
% The user can also generate a customized diet with the DietDesigner tool and 
% use it for simulations with AGORA. Note that the diets were designed for microbiome 
% simulations and the predicted growth rates may be very high for single AGORA 
% models.
%%
dietConstraints=adaptVMHDietToAGORA('AverageEuropeanDiet','AGORA');
clear data
for i=1:size(inputModels,1)
    model=inputModels{i,1};
    model=changeObjective(model,model.rxns(find(strncmp(model.rxns,'biomass',7))));
    model=useDiet(model,dietConstraints);
    FBA=optimizeCbModel(model,'max');
    data(i,1)=FBA.f;
    % Enable uptake of oxygen
    model=changeRxnBounds(model,'EX_o2(e)',-10,'l');
    FBA=optimizeCbModel(model,'max');
    data(i,2)=FBA.f;
end
%% Plot the growth rates on the Average European diet.
%%
dataAll=vertcat(data(:,1),data(:,2));
group=cell(size(data,1),2);
group(:,1)={'Average European diet, anoxic'};
group(:,2)={'Average European diet, oxic'};
groupAll=vertcat(group(:,1),group(:,2));
figure
boxplot(dataAll,groupAll,'PlotStyle','traditional','BoxStyle','outline')
h = findobj(gca,'Tag','Box');
% Change colors
for j=1:length(h)
    if j==1
        patch(get(h(j),'XData'),get(h(j),'YData'),'g','FaceAlpha',.5);
    end
    if j==2
        patch(get(h(j),'XData'),get(h(j),'YData'),'b','FaceAlpha',.5);
    end
end
set(gca, 'FontSize', 12)
title('Growth rates in 818 AGORA gut microbe models on an Average European diet')
##### SOURCE END #####
--></body></html>